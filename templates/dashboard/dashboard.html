{% extends 'base.html' %}

{% block title %}Blinkr Loan - Disbursal Dashboard{% endblock %}

{% block content %}
<div class="flex h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50">
         <!-- Enhanced Sidebar Filters -->
     <div class="sidebar fixed md:relative md:translate-x-0 z-40 w-72 sidebar-transition shadow-strong" style="background: linear-gradient(135deg, #3b82f6 0%, #6366f1 50%, #8b5cf6 100%); border-right: 1px solid rgba(255, 255, 255, 0.2);">
        <div class="p-6">
                         <!-- Enhanced Header -->
             <div class="mb-8">
                 <div class="mb-4">
                     <h3 class="text-3xl font-bold" style="color: #ffffff;">Filters</h3>
                     <p class="text-xs" style="color: rgba(255, 255, 255, 0.8);">Refine your data view</p>
                 </div>
             </div>
            
            <!-- Enhanced Filter Controls -->
            <div class="space-y-4">
                                 <div class="filter-group">
                     <label class="block text-base font-semibold mb-2 flex items-center" style="color: rgba(255, 255, 255, 0.9);">
                         <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #ffffff;">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                         </svg>
                         Reloan Case
                     </label>
                    <select class="enhanced-filter-dropdown w-full" id="reloan-filter">
                        <option value="">All Cases</option>
                        <option value="new">New Applications</option>
                        <option value="reloan">Reloan Cases</option>
                    </select>
                </div>
                
                <div class="filter-group">
                                         <label class="block text-base font-semibold mb-2 flex items-center" style="color: rgba(255, 255, 255, 0.9);">
                         <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #ffffff;">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                         </svg>
                         Active Cases
                     </label>
                    <select class="enhanced-filter-dropdown w-full" id="active-filter">
                        <option value="">All Status</option>
                        <option value="active">Active Cases</option>
                        <option value="inactive">Inactive Cases</option>
                    </select>
                </div>
                
                <div class="filter-group">
                                         <label class="block text-base font-semibold mb-2 flex items-center" style="color: rgba(255, 255, 255, 0.9);">
                         <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #ffffff;">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                         </svg>
                         Tenure
                     </label>
                    <select class="enhanced-filter-dropdown w-full" id="tenure-filter">
                        <option value="">All Tenures</option>
                        <option value="6">6 months</option>
                        <option value="12">12 months</option>
                        <option value="18">18 months</option>
                        <option value="24">24 months</option>
                    </select>
                </div>
                
                <div class="filter-group">
                                         <label class="block text-base font-semibold mb-2 flex items-center" style="color: rgba(255, 255, 255, 0.9);">
                         <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #ffffff;">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                         </svg>
                         State
                     </label>
                                         <select class="enhanced-filter-dropdown w-full" id="state-filter">
                         <option value="">All States</option>
                     </select>
                </div>
                
                <div class="filter-group">
                                         <label class="block text-base font-semibold mb-2 flex items-center" style="color: rgba(255, 255, 255, 0.9);">
                         <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #ffffff;">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                         </svg>
                         City
                     </label>
                                         <select class="enhanced-filter-dropdown w-full" id="city-filter">
                         <option value="">All Cities</option>
                     </select>
                </div>

                <!-- Enhanced Action Buttons -->
                <div class="space-y-2 pt-3">
                    <button id="apply-filters" class="w-full py-1 px-2 rounded-md text-sm font-semibold shadow-glow hover:shadow-glow-lg transition-all duration-300 hover-lift" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 100%); border: 1px solid rgba(255, 255, 255, 0.4); color: #ffffff;">
                        <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"></path>
                        </svg>
                        Apply Filters
                    </button>

                    <button id="clear-filters" class="w-full py-1 px-2 rounded-md text-sm font-semibold shadow-soft hover:shadow-medium transition-all duration-300 hover-lift" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%); border: 1px solid rgba(255, 255, 255, 0.3); color: #ffffff;">
                        <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        Clear Filters
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content flex-1 flex flex-col overflow-hidden">
                 <!-- Enhanced Top Header -->
         <header class="bg-white/80 backdrop-blur-xl border-b border-white/20 p-6 shadow-soft">
            
             
             <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                 <!-- Logo Section -->
                 <div class="flex justify-center md:justify-start">
                     <div class="w-28 h-24 flex items-center justify-center shadow-glow">
                         <img src="/static/Assets/logo.svg" alt="Blinkr Loan Logo" class="w-full h-full object-contain dashboard-logo">
                     </div>
                 </div>
                  <!-- Disbursal Heading at Top Center -->
             <div class="flex justify-center mb-4">
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent tracking-wide">
                    Disbursal Dashboard
                </h1>
            </div>
                 
                 <!-- Enhanced Controls Section -->
                 <div class="flex flex-col lg:flex-row items-center space-y-3 lg:space-y-0 lg:space-x-14">
                     <!-- Logout Button -->
                     <a href="/logout/" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 flex items-center space-x-2 shadow-glow">
                         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                         </svg>
                         <span>Logout</span>
                     </a>
                     
                     <!-- Enhanced Date Range Filter -->
                     <div class="flex flex-col space-y-2">
                         <div class="flex items-center space-x-2 bg-white/60 backdrop-blur-sm rounded-lg p-2 shadow-soft">
                             <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                             </svg>
                             <input type="date" id="start-date" class="enhanced-date-input" value="2025-08-23">
                             <span class="text-gray-500 font-medium">to</span>
                             <input type="date" id="end-date" class="enhanced-date-input" value="2025-08-23">
                         </div>
                         <div class="text-xs text-gray-600 text-center bg-white/40 rounded px-2 py-1" id="date-range-display">
                             Date Range: Loading...
                         </div>
                     </div>
                     
                     <!-- Enhanced Avg Disbursal Amount Card -->
                     <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl px-4 py-3 text-white shadow-glow hover:shadow-glow-lg transition-all duration-300 hover-lift">
                         <div class="text-xs font-medium text-blue-100">Avg. Disbursal Amount</div>
                         <div class="text-xl font-bold" id="avg-disbursal">₹27,570.76</div>
                         <div class="text-xs text-blue-200 mt-1">Updated today</div>
                     </div>
                 </div>
             </div>
         </header>

        <!-- Main Dashboard Content -->
        <main class="flex-1 overflow-y-auto p-8 bg-transparent custom-scrollbar">
            <!-- Enhanced Summary Cards -->
                         <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-8">
                                 <!-- Total Applications Card -->
                 <div class="enhanced-stat-card animate-on-scroll group hover:scale-105 transition-all duration-500">
                     <div class="relative overflow-hidden">
                         <!-- Animated Background Pattern -->
                         <div class="absolute inset-0 bg-gradient-to-br from-blue-50 to-indigo-100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                         <!-- Header Icon at Top Center -->
                         <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-10">
                             <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-glow">
                                 <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                 </svg>
                             </div>
                         </div>
                         <!-- Content -->
                         <div class="relative pt-16 pb-4 px-4 text-center flex flex-col justify-between" style="z-index: 15; min-height: 80px;">
                             <div class="flex-1 flex flex-col justify-center min-h-8">
                                 <p class="text-xs text-gray-600 font-medium tracking-wide" style="color: #374151 !important; opacity: 1 !important; visibility: visible !important; position: relative !important; z-index: 20 !important;" title="Total Applications">Total Applications</p>
                             </div>
                             <div class="flex-1 flex flex-col justify-center">
                                 <p class="text-lg font-bold text-gray-900" id="total-applications">17</p>
                             </div>
                         </div>
                     </div>
                 </div>

                                 <!-- Sanction Amount Card -->
                 <div class="enhanced-stat-card animate-on-scroll group hover:scale-105 transition-all duration-500">
                     <div class="relative overflow-hidden">
                         <!-- Animated Background Pattern -->
                         <div class="absolute inset-0 bg-gradient-to-br from-green-50 to-emerald-100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                         <!-- Header Icon at Top Center -->
                         <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-10">
                             <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-glow">
                                 <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                 </svg>
                             </div>
                         </div>
                         <!-- Content -->
                         <div class="relative pt-16 pb-4 px-4 text-center flex flex-col justify-between" style="min-height: 80px;">
                             <div class="flex-1 flex flex-col justify-center min-h-8">
                                 <p class="text-xs text-gray-600 font-medium tracking-wide" style="color: #374151 !important; opacity: 1 !important; visibility: visible !important; position: relative !important; z-index: 20 !important;" title="Sanction Amount">Sanction Amount</p>
                             </div>
                             <div class="flex-1 flex flex-col justify-center">
                                 <p class="text-lg font-bold text-gray-900" id="sanction-amount">₹4,68,703</p>
                             </div>
                         </div>
                     </div>
                 </div>

                                 <!-- Disbursed Amount Card -->
                 <div class="enhanced-stat-card animate-on-scroll group hover:scale-105 transition-all duration-500">
                     <div class="relative overflow-hidden">
                         <!-- Animated Background Pattern -->
                         <div class="absolute inset-0 bg-gradient-to-br from-blue-50 to-cyan-100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                         <!-- Header Icon at Top Center -->
                         <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-10">
                             <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl flex items-center justify-center shadow-glow">
                                 <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                                 </svg>
                             </div>
                         </div>
                         <!-- Content -->
                         <div class="relative pt-16 pb-4 px-4 text-center flex flex-col justify-between" style="min-height: 80px;">
                             <div class="flex-1 flex flex-col justify-center min-h-8">
                                 <p class="text-xs text-gray-600 font-medium tracking-wide" style="color: #374151 !important; opacity: 1 !important; visibility: visible !important; position: relative !important; z-index: 20 !important;" title="Disbursed Amount">Disbursed Amount</p>
                             </div>
                             <div class="flex-1 flex flex-col justify-center">
                                 <p class="text-lg font-bold text-gray-900" id="disbursed-amount">₹3,97,875</p>
                             </div>
                         </div>
                     </div>
                 </div>

                                 <!-- PF Amount Card -->
                 <div class="enhanced-stat-card animate-on-scroll group hover:scale-105 transition-all duration-500">
                     <div class="relative overflow-hidden">
                         <!-- Animated Background Pattern -->
                         <div class="absolute inset-0 bg-gradient-to-br from-purple-50 to-violet-100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                         <!-- Header Icon at Top Center -->
                         <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-10">
                             <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl flex items-center justify-center shadow-glow">
                                 <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                 </svg>
                             </div>
                         </div>
                         <!-- Content -->
                         <div class="relative pt-16 pb-4 px-4 text-center flex flex-col justify-between" style="min-height: 80px;">
                             <div class="flex-1 flex flex-col justify-center min-h-8">
                                 <p class="text-xs text-gray-600 font-medium tracking-wide" style="color: #374151 !important; opacity: 1 !important; visibility: visible !important; position: relative !important; z-index: 20 !important;" title="PF Amount">PF Amount</p>
                             </div>
                             <div class="flex-1 flex flex-col justify-center">
                                 <p class="text-lg font-bold text-gray-900" id="pf-amount">₹70,303</p>
                             </div>
                         </div>
                     </div>
                 </div>

                                 <!-- Interest Amount Card -->
                 <div class="enhanced-stat-card animate-on-scroll group hover:scale-105 transition-all duration-500">
                     <div class="relative overflow-hidden">
                         <!-- Animated Background Pattern -->
                         <div class="absolute inset-0 bg-gradient-to-br from-red-50 to-rose-100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                         <!-- Header Icon at Top Center -->
                         <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-10">
                             <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl flex items-center justify-center shadow-glow">
                                 <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                 </svg>
                             </div>
                         </div>
                         <!-- Content -->
                         <div class="relative pt-16 pb-4 px-4 text-center flex flex-col justify-between" style="min-height: 80px;">
                             <div class="flex-1 flex flex-col justify-center min-h-8">
                                 <p class="text-xs text-gray-600 font-medium tracking-wide" style="color: #374151 !important; opacity: 1 !important; visibility: visible !important; position: relative !important; z-index: 20 !important;" title="Interest Amount">Interest Amount</p>
                             </div>
                             <div class="flex-1 flex flex-col justify-center">
                                 <p class="text-lg font-bold text-gray-900" id="interest-amount">₹70,216</p>
                             </div>
                         </div>
                     </div>
                 </div>

                                 <!-- Repayment Amount Card -->
                 <div class="enhanced-stat-card animate-on-scroll group hover:scale-105 transition-all duration-500">
                     <div class="relative overflow-hidden">
                         <!-- Animated Background Pattern -->
                         <div class="absolute inset-0 bg-gradient-to-br from-amber-50 to-orange-100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                         <!-- Header Icon at Top Center -->
                         <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-10">
                             <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-glow">
                                 <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                 </svg>
                             </div>
                         </div>
                         <!-- Content -->
                         <div class="relative pt-16 pb-4 px-4 text-center flex flex-col justify-between" style="min-height: 80px;">
                             <div class="flex-1 flex flex-col justify-center min-h-8">
                                 <p class="text-xs text-gray-600 font-medium tracking-wide" style="color: #374151 !important; opacity: 1 !important; visibility: visible !important; position: relative !important; z-index: 20 !important;" title="Repayment Amount">Repayment Amount</p>
                             </div>
                             <div class="flex-1 flex flex-col justify-center">
                                 <p class="text-lg font-bold text-gray-900" id="repayment-amount">₹5,38,919</p>
                             </div>
                         </div>
                     </div>
                 </div>
            </div>

            <!-- Enhanced Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Enhanced State Wise Distribution -->
                <div class="enhanced-chart-card animate-on-scroll">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900">State Wise Distribution</h3>
                        <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse-gentle"></div>
                    </div>
                    <div class="chart-container">
                        <canvas id="stateChart"></canvas>
                    </div>
                </div>

                <!-- Enhanced City Wise Distribution -->
                <div class="enhanced-chart-card animate-on-scroll">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900">City Wise Distribution</h3>
                        <div class="w-3 h-3 bg-indigo-500 rounded-full animate-pulse-gentle"></div>
                    </div>
                    <div class="chart-container">
                        <canvas id="cityChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Enhanced Data Table -->
            <div class="enhanced-table-card animate-on-scroll">
                <div class="p-8 border-b border-gray-100">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Loan Applications</h3>
                                <p class="text-sm text-gray-500">Detailed view of all applications</p>
                            </div>
                        </div>
                        
                        <!-- Enhanced Search and Controls -->
                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                            <div class="relative">
                                <input type="text" id="search-input" placeholder="Search by name..." 
                                       class="enhanced-search-input pl-12 w-full sm:w-80">
                                <svg class="absolute left-4 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <label class="text-sm text-gray-700 font-medium">Show:</label>
                                <select id="per-page" class="enhanced-select-dropdown">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Table -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="enhanced-table-header">
                                <th class="table-header-cell">Disbursal Date</th>
                                <th class="table-header-cell">Full Name</th>
                                <th class="table-header-cell">Sanction Amount</th>
                                <th class="table-header-cell">Disbursal Amount</th>
                                <th class="table-header-cell">Processing Fee</th>
                                <th class="table-header-cell">Interest Amount</th>
                                <th class="table-header-cell">Repayment Amount</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- Table data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Enhanced Pagination -->
                <div class="p-8">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                        <div class="text-sm text-gray-600">
                            Showing <span id="showing-start" class="font-semibold text-gray-900">1</span> to <span id="showing-end" class="font-semibold text-gray-900">10</span> of <span id="total-items" class="font-semibold text-gray-900">0</span> results
                        </div>
                        
                        <div class="flex items-center space-x-2" id="pagination">
                            <!-- Pagination controls will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
// Enhanced Dashboard functionality
class Dashboard {
    constructor() {
        this.currentPage = 1;
        this.perPage = 10;
        this.searchTerm = '';
        this.filters = {
            reloan: '',
            active: '',
            tenure: '',
            state: '',
            city: ''
        };
        this.stateChart = null;
        this.cityChart = null;
        this.applicationsData = [];
        this.init();
    }

    async init() {
        // Set dynamic default dates based on available data
        this.setDefaultDates();
        
        await this.loadSummaryData();
        await this.loadChartsData();
        await this.loadTableData();
        this.setupEventListeners();
        this.initializeAnimations();
    }
    
    setDefaultDates() {
        // Set default dates to last 30 days
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        
        // Format dates for input fields (YYYY-MM-DD)
        const todayStr = today.toISOString().split('T')[0];
        const thirtyDaysAgoStr = thirtyDaysAgo.toISOString().split('T')[0];
        
        // Set the date input values
        document.getElementById('start-date').value = thirtyDaysAgoStr;
        document.getElementById('end-date').value = todayStr;
        
        // Set min/max attributes for date inputs based on available data
        this.setDateConstraints();
        
        // Update the date range display
        this.updateDateRangeDisplay();
        
        console.log(`Default dates set: ${thirtyDaysAgoStr} to ${todayStr}`);
    }
    
    async setDateConstraints() {
        try {
            // Get actual date range from API
            const response = await fetch('/api/date-range/');
            const data = await response.json();
            
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            
            if (data.min_date && data.max_date) {
                // Set min/max dates from API data
                startDateInput.min = data.min_date;
                startDateInput.max = data.max_date;
                endDateInput.min = data.min_date;
                endDateInput.max = data.max_date;
                
                console.log(`Date constraints set from API: ${data.min_date} to ${data.max_date}`);
            } else {
                // Fallback to reasonable defaults
                const minDate = new Date();
                minDate.setFullYear(minDate.getFullYear() - 2);
                
                const maxDate = new Date();
                maxDate.setFullYear(maxDate.getFullYear() + 1);
                
                const minDateStr = minDate.toISOString().split('T')[0];
                const maxDateStr = maxDate.toISOString().split('T')[0];
                
                startDateInput.min = minDateStr;
                startDateInput.max = maxDateStr;
                endDateInput.min = minDateStr;
                endDateInput.max = maxDateStr;
                
                console.log(`Date constraints set to defaults: ${minDateStr} to ${maxDateStr}`);
            }
        } catch (error) {
            console.error('Error setting date constraints:', error);
            // Use fallback defaults
            this.setFallbackDateConstraints();
        }
    }
    
    setFallbackDateConstraints() {
        const startDateInput = document.getElementById('start-date');
        const endDateInput = document.getElementById('end-date');
        
        // Set reasonable min/max dates (e.g., last 2 years to next year)
        const minDate = new Date();
        minDate.setFullYear(minDate.getFullYear() - 2);
        
        const maxDate = new Date();
        maxDate.setFullYear(maxDate.getFullYear() + 1);
        
        // Format for input attributes
        const minDateStr = minDate.toISOString().split('T')[0];
        const maxDateStr = maxDate.toISOString().split('T')[0];
        
        startDateInput.min = minDateStr;
        startDateInput.max = maxDateStr;
        endDateInput.min = minDateStr;
        endDateInput.max = maxDateStr;
        
        console.log(`Fallback date constraints set: ${minDateStr} to ${maxDateStr}`);
    }
    
    validateDateRange() {
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        
        if (startDate && endDate && startDate > endDate) {
            // If start date is after end date, show warning and reset end date
            alert('Start date cannot be after end date. Please select a valid date range.');
            document.getElementById('end-date').value = startDate;
            console.log('Date range validation: End date reset to start date');
        }
    }
    
    getCurrentDateRange() {
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        return { startDate, endDate };
    }
    
    logCurrentDateRange() {
        const { startDate, endDate } = this.getCurrentDateRange();
        console.log(`Current date range: ${startDate} to ${endDate}`);
        return { startDate, endDate };
    }
    
    updateDateRangeDisplay() {
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        const displayElement = document.getElementById('date-range-display');
        
        if (startDate && endDate) {
            const start = new Date(startDate).toLocaleDateString('en-IN');
            const end = new Date(endDate).toLocaleDateString('en-IN');
            displayElement.textContent = `Date Range: ${start} to ${end}`;
        } else {
            displayElement.textContent = 'Date Range: Please select dates';
        }
    }

    initializeAnimations() {
        // Add staggered animations to cards
        const cards = document.querySelectorAll('.animate-on-scroll');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    }

    async loadSummaryData() {
        try {
            // Get date range values
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            console.log(`Loading summary data for date range: ${startDate} to ${endDate}`);
            
            // Use local Django API endpoint with date parameters
            const url = `/api/summary/?start_date=${startDate}&end_date=${endDate}`;
            console.log(`API URL: ${url}`);
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data) {
                // Update dashboard elements with local data
                document.getElementById('total-applications').textContent = data.total_applications;
                document.getElementById('sanction-amount').textContent = `₹${this.formatNumber(data.total_sanction_amount)}`;
                document.getElementById('disbursed-amount').textContent = `₹${this.formatNumber(data.total_disbursed_amount)}`;
                document.getElementById('pf-amount').textContent = `₹${this.formatNumber(data.total_pf_amount)}`;
                document.getElementById('interest-amount').textContent = `₹${this.formatNumber(data.total_interest_amount)}`;
                document.getElementById('repayment-amount').textContent = `₹${this.formatNumber(data.total_repayment_amount)}`;
                document.getElementById('avg-disbursal').textContent = `₹${this.formatNumber(data.avg_disbursal)}`;
                
                // Load charts and table data with same date range
                await this.loadChartsData();
                await this.loadTableData();
            }
        } catch (error) {
            console.error('Error loading summary data:', error);
            // Fallback to default values
            this.loadDefaultData();
        }
    }
    
    loadDefaultData() {
        // Set default values if API fails
        document.getElementById('total-applications').textContent = '17';
        document.getElementById('sanction-amount').textContent = '₹4,68,703';
        document.getElementById('disbursed-amount').textContent = '₹3,97,875';
        document.getElementById('pf-amount').textContent = '₹70,303';
        document.getElementById('interest-amount').textContent = '₹70,216';
        document.getElementById('repayment-amount').textContent = '₹5,38,919';
        document.getElementById('avg-disbursal').textContent = '₹27,570.76';
    }

    async loadChartsData() {
        try {
            // Get date range values
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            // Use local Django API endpoint for charts data with date parameters
            const url = `/api/charts/?start_date=${startDate}&end_date=${endDate}`;
            const response = await fetch(url);
            const data = await response.json();
            
            if (data) {
                // Create charts with local data
                this.createStateChart(data.state_data);
                this.createCityChart(data.city_data);
            }
        } catch (error) {
            console.error('Error loading charts data:', error);
            // Use default chart data
            this.createDefaultCharts();
        }
    }
    
    createDefaultCharts() {
        // Default chart data if API fails
        const defaultStateData = [
            { state: 'Delhi', value: 150000, percentage: 45.2 },
            { state: 'Haryana', value: 120000, percentage: 36.1 },
            { state: 'Uttar Pradesh', value: 62000, percentage: 18.7 }
        ];
        
        const defaultCityData = [
            { city: 'Gurugram', value: 80000, percentage: 24.1 },
            { city: 'Delhi', value: 75000, percentage: 22.6 },
            { city: 'Noida', value: 65000, percentage: 19.6 },
            { city: 'Faridabad', value: 45000, percentage: 13.6 },
            { city: 'Ghaziabad', value: 35000, percentage: 10.5 },
            { city: 'Others', value: 32000, percentage: 9.6 }
        ];
        
        this.createStateChart(defaultStateData);
        this.createCityChart(defaultCityData);
    }

    async loadFilteredChartsData() {
        try {
            if (this.applicationsData && this.applicationsData.length > 0) {
                // Apply filters to the data
                const filteredData = this.applyFilters(this.applicationsData);
                
                // Process filtered state data
                const stateData = this.processStateData(filteredData);
                this.updateStateChart(stateData);
                
                // Process filtered city data
                const cityData = this.processCityData(filteredData);
                this.updateCityChart(cityData);
            }
        } catch (error) {
            console.error('Error loading filtered charts data:', error);
        }
    }

    async loadTableData() {
        try {
            // Get date range values
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            // Use local Django API endpoint for table data with date parameters
            const url = `/api/table/?start_date=${startDate}&end_date=${endDate}`;
            const response = await fetch(url);
            const data = await response.json();
            
            if (data && data.applications) {
                // Store the data for filtering and pagination
                this.applicationsData = data.applications;
                this.totalItems = data.total_items;
                this.totalPages = data.total_pages;
                this.currentPage = data.current_page;
                
                // Render the table
                this.renderTable();
                
                // Populate filter options
                this.populateFilterOptions();
            }
        } catch (error) {
            console.error('Error loading table data:', error);
            // Use default table data
            this.loadDefaultTableData();
        }
    }
    
    loadDefaultTableData() {
        // Default table data if API fails
        this.applicationsData = [
            {
                id: 1,
                disbursal_date: '2025-01-15',
                full_name: 'John Doe',
                sanction_amount: 50000,
                disbursed_amount: 45000,
                processing_fee: 5000,
                interest_amount: 3000,
                repayment_amount: 53000
            },
            {
                id: 2,
                disbursal_date: '2025-01-16',
                full_name: 'Jane Smith',
                sanction_amount: 75000,
                disbursed_amount: 70000,
                processing_fee: 7500,
                interest_amount: 4500,
                repayment_amount: 79000
            }
        ];
        
        this.totalItems = this.applicationsData.length;
        this.totalPages = 1;
        this.currentPage = 1;
        
        this.renderTable();
        this.populateFilterOptions();
    }

    createStateChart(data) {
        const ctx = document.getElementById('stateChart').getContext('2d');
        
                     this.stateChart = new Chart(ctx, {
                 type: 'pie',
                 data: {
                     labels: data.map(item => item.state),
                     datasets: [{
                         data: data.map(item => item.value),
                         backgroundColor: [
                             '#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#84cc16'
                         ],
                         borderWidth: 3,
                         borderColor: '#ffffff',
                         hoverBorderWidth: 4,
                         hoverBorderColor: '#f8fafc'
                     }]
                 },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#374151',
                            font: {
                                family: 'Inter',
                                size: 12,
                                weight: '500'
                            },
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                                         tooltip: {
                         backgroundColor: 'rgba(255, 255, 255, 0.98)',
                         titleColor: '#1e293b',
                         bodyColor: '#374151',
                         borderColor: '#e2e8f0',
                         borderWidth: 2,
                         cornerRadius: 12,
                         displayColors: true,
                         titleFont: {
                             size: 14,
                             weight: '600'
                         },
                         bodyFont: {
                             size: 13,
                             weight: '500'
                         },
                         padding: 12,
                         callbacks: {
                             label: function(context) {
                                 const item = data[context.dataIndex];
                                 return `${item.state}: ₹${this.formatNumber(item.value)} (${item.percentage}%)`;
                             }.bind(this)
                         }
                     }
                },
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 1500,
                    easing: 'easeOutQuart'
                },
                hover: {
                    animationDuration: 400
                }
            }
        });
    }

    createCityChart(data) {
        const ctx = document.getElementById('cityChart').getContext('2d');
        
                     this.cityChart = new Chart(ctx, {
                 type: 'doughnut',
                 data: {
                     labels: data.map(item => item.city),
                     datasets: [{
                         data: data.map(item => item.value),
                         backgroundColor: [
                             '#f97316', '#ec4899', '#8b5cf6', '#06b6d4', '#10b981', '#84cc16', '#f59e0b', '#ef4444', '#6366f1', '#a855f7'
                         ],
                         borderWidth: 3,
                         borderColor: '#ffffff',
                         hoverBorderWidth: 4,
                         hoverBorderColor: '#f8fafc'
                     }]
                 },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#374151',
                            font: {
                                family: 'Inter',
                                size: 12,
                                weight: '500'
                            },
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                                         tooltip: {
                         backgroundColor: 'rgba(255, 255, 255, 0.98)',
                         titleColor: '#1e293b',
                         bodyColor: '#374151',
                         borderColor: '#e2e8f0',
                         borderWidth: 2,
                         cornerRadius: 12,
                         displayColors: true,
                         titleFont: {
                             size: 14,
                             weight: '600'
                         },
                         bodyFont: {
                             size: 13,
                             weight: '500'
                         },
                         padding: 12,
                         callbacks: {
                             label: function(context) {
                                 const item = data[context.dataIndex];
                                 return `${item.city}: ₹${this.formatNumber(item.value)} (${item.percentage}%)`;
                             }.bind(this)
                         }
                     }
                },
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 1500,
                    easing: 'easeOutQuart'
                },
                hover: {
                    animationDuration: 400
                }
            }
        });
    }

    updateStateChart(data) {
        if (this.stateChart) {
            this.stateChart.data.labels = data.map(item => item.state);
            this.stateChart.data.datasets[0].data = data.map(item => item.value);
            this.stateChart.update('active');
        }
    }

    updateCityChart(data) {
        if (this.cityChart) {
            this.cityChart.data.labels = data.map(item => item.city);
            this.cityChart.data.datasets[0].data = data.map(item => item.value);
            this.cityChart.update('active');
        }
    }

    renderTable(data) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        data.forEach((row, index) => {
            const tr = document.createElement('tr');
            tr.className = 'enhanced-table-row';
            tr.style.animationDelay = `${index * 0.05}s`;
            
            // Format dates
            const disbursalDate = new Date(row.disbursal_date).toLocaleDateString('en-IN');
            
            tr.innerHTML = `
                <td class="table-cell">${disbursalDate}</td>
                <td class="table-cell font-semibold">${row.full_name}</td>
                <td class="table-cell font-mono">₹${this.formatNumber(row.loan_amount)}</td>
                <td class="table-cell font-mono">₹${this.formatNumber(row.Disbursal_Amt)}</td>
                <td class="table-cell font-mono">₹${this.formatNumber(row.processing_fee)}</td>
                <td class="table-cell font-mono">₹${this.formatNumber(row.interest_amount)}</td>
                <td class="table-cell font-mono font-semibold">₹${this.formatNumber(row.repayment_amount)}</td>
            `;
            
            tbody.appendChild(tr);
        });
    }

    renderPagination(pagination) {
        const paginationContainer = document.getElementById('pagination');
        const { current_page, total_pages, total_items, per_page } = pagination;
        
        // Update showing info
        const start = (current_page - 1) * per_page + 1;
        const end = Math.min(current_page * per_page, total_items);
        
        document.getElementById('showing-start').textContent = start;
        document.getElementById('showing-end').textContent = end;
        document.getElementById('total-items').textContent = total_items;
        
        // Create pagination controls
        let paginationHTML = '';
        
        if (total_pages > 1) {
            // Previous button
            if (current_page > 1) {
                paginationHTML += `<button class="enhanced-pagination-btn" onclick="dashboard.goToPage(${current_page - 1})">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Previous
                </button>`;
            }
            
            // Page numbers
            for (let i = Math.max(1, current_page - 2); i <= Math.min(total_pages, current_page + 2); i++) {
                if (i === current_page) {
                    paginationHTML += `<span class="enhanced-pagination-current">${i}</span>`;
                } else {
                    paginationHTML += `<button class="enhanced-pagination-btn" onclick="dashboard.goToPage(${i})">${i}</button>`;
                }
            }
            
            // Next button
            if (current_page < total_pages) {
                paginationHTML += `<button class="enhanced-pagination-btn" onclick="dashboard.goToPage(${current_page + 1})">
                    Next
                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>`;
            }
        }
        
        paginationContainer.innerHTML = paginationHTML;
    }

    goToPage(page) {
        this.currentPage = page;
        this.loadTableData();
    }

    updateFilters() {
        this.filters = {
            reloan: document.getElementById('reloan-filter').value,
            active: document.getElementById('active-filter').value,
            tenure: document.getElementById('tenure-filter').value,
            state: document.getElementById('state-filter').value,
            city: document.getElementById('city-filter').value
        };
    }

    clearFilters() {
        document.getElementById('reloan-filter').value = '';
        document.getElementById('active-filter').value = '';
        document.getElementById('tenure-filter').value = '';
        document.getElementById('state-filter').value = '';
        document.getElementById('city-filter').value = '';
        
        this.filters = {
            reloan: '',
            active: '',
            tenure: '',
            state: '',
            city: ''
        };
    }

    setupEventListeners() {
        // Search input
        document.getElementById('search-input').addEventListener('input', (e) => {
            this.searchTerm = e.target.value;
            this.currentPage = 1;
            this.loadTableData();
        });

        // Per page selector
        document.getElementById('per-page').addEventListener('change', (e) => {
            this.perPage = parseInt(e.target.value);
            this.currentPage = 1;
            this.loadTableData();
        });

        // Date range changes
        document.getElementById('start-date').addEventListener('change', () => {
            console.log('Start date changed, refreshing data...');
            this.validateDateRange();
            this.updateDateRangeDisplay();
            this.loadSummaryData();
        });

        document.getElementById('end-date').addEventListener('change', () => {
            console.log('End date changed, refreshing data...');
            this.validateDateRange();
            this.updateDateRangeDisplay();
            this.loadSummaryData();
        });

        // Apply filters button
        document.getElementById('apply-filters').addEventListener('click', () => {
            this.updateFilters();
            this.currentPage = 1;
            this.loadFilteredChartsData();
            this.loadTableData();
        });

        // Clear filters button
        document.getElementById('clear-filters').addEventListener('click', () => {
            this.clearFilters();
            this.currentPage = 1;
            this.loadChartsData();
            this.loadTableData();
        });

        // Individual filter changes (optional: auto-apply)
        document.getElementById('state-filter').addEventListener('change', () => {
            this.updateFilters();
            this.loadFilteredChartsData();
        });

        document.getElementById('city-filter').addEventListener('change', () => {
            this.updateFilters();
            this.loadFilteredChartsData();
        });
    }

    formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // Process state data for charts
    processStateData(data) {
        const stateMap = {};
        
        data.forEach(app => {
            const state = app.state;
            const amount = parseFloat(app.Disbursal_Amt || 0);
            
            if (stateMap[state]) {
                stateMap[state] += amount;
            } else {
                stateMap[state] = amount;
            }
        });
        
        const total = Object.values(stateMap).reduce((sum, val) => sum + val, 0);
        
        return Object.entries(stateMap).map(([state, value]) => ({
            state: state,
            value: value,
            percentage: ((value / total) * 100).toFixed(1)
        }));
    }
    
    // Process city data for charts
    processCityData(data) {
        const cityMap = {};
        
        data.forEach(app => {
            const city = app.city;
            const amount = parseFloat(app.Disbursal_Amt || 0);
            
            if (cityMap[city]) {
                cityMap[city] += amount;
            } else {
                cityMap[city] = amount;
            }
        });
        
        const total = Object.values(cityMap).reduce((sum, val) => sum + val, 0);
        
        return Object.entries(cityMap).map(([city, value]) => ({
            city: city,
            value: value,
            percentage: ((value / total) * 100).toFixed(1)
        }));
    }
    
    // Apply filters to data
    applyFilters(data) {
        let filteredData = [...data];
        
        if (this.filters.reloan !== '') {
            const isReloan = this.filters.reloan === 'reloan';
            filteredData = filteredData.filter(app => app.is_reloan_case === isReloan);
        }
        
        if (this.filters.active !== '') {
            const isActive = this.filters.active === 'active';
            filteredData = filteredData.filter(app => app.is_lead_closed === !isActive);
        }
        
        if (this.filters.tenure !== '') {
            const tenure = parseInt(this.filters.tenure);
            filteredData = filteredData.filter(app => app.tenure === tenure);
        }
        
        if (this.filters.state !== '') {
            filteredData = filteredData.filter(app => app.state === this.filters.state);
        }
        
        if (this.filters.city !== '') {
            filteredData = filteredData.filter(app => app.city === this.filters.city);
        }
        
        return filteredData;
    }
    
    // Populate filter options dynamically
    populateFilterOptions() {
        if (!this.applicationsData || this.applicationsData.length === 0) return;
        
        // Get unique states
        const states = [...new Set(this.applicationsData.map(app => app.state))].sort();
        const stateFilter = document.getElementById('state-filter');
        
        // Clear existing options except "All States"
        stateFilter.innerHTML = '<option value="">All States</option>';
        
        // Add state options
        states.forEach(state => {
            if (state) {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateFilter.appendChild(option);
            }
        });
        
        // Get unique cities
        const cities = [...new Set(this.applicationsData.map(app => app.city))].sort();
        const cityFilter = document.getElementById('city-filter');
        
        // Clear existing options except "All Cities"
        cityFilter.innerHTML = '<option value="">All Cities</option>';
        
        // Add city options
        cities.forEach(city => {
            if (city) {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                cityFilter.appendChild(option);
            }
        });
    }
}

// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', () => {
    window.dashboard = new Dashboard();
});
</script>
{% endblock %}
